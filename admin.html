<!DOCTYPE html>
<html lang="fa">
<head>
  <meta charset="UTF-8">
  <title>Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª </title>
  <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Vazirmatn', sans-serif;
      background: linear-gradient(to left, #f8f8f8, #eeeeee);
      direction: rtl;
    }

    .navbar {
      background-color: #512da8;
      padding: 20px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    .navbar h1 {
      font-size: 1.5rem;
      margin: 0;
    }
    .navbar button {
      background: #d32f2f;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
    }

    .container {
      max-width: 1000px;
      margin: 40px auto;
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .stats {
      display: flex;
      justify-content: space-around;
      margin-bottom: 30px;
    }

    .card {
      background: #f3e5f5;
      padding: 20px;
      border-radius: 15px;
      text-align: center;
      flex: 1;
      margin: 0 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
    }

    .search-add {
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
      margin-bottom: 20px;
    }
    .search-add input {
      padding: 10px;
      border-radius: 10px;
      border: 1px solid #ccc;
      margin: 5px;
      width: 250px;
    }
    .search-add button {
      background-color: #388e3c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 10px;
      margin: 5px;
      cursor: pointer;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      border-radius: 10px;
      overflow: hidden;
    }
    th, td {
      padding: 15px;
      border-bottom: 1px solid #eee;
      text-align: center;
    }
    th {
      background-color: #673ab7;
      color: white;
    }
    td button {
      padding: 6px 12px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      margin: 0 5px;
    }
    .edit { background: #0288d1; color: white; }
    .delete { background: #e53935; color: white; }

    .toast {
      position: fixed;
      bottom: 30px;
      right: 30px;
      background-color: #4caf50;
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.2);
      display: none;
    }

    .role {
  background: #ff9800;
  color: white;
}
  </style>
</head>
<body>
  <div class="navbar">
    <h1>ğŸ‘‘ Ù¾Ù†Ù„ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾ÛŒØ´Ø±ÙØªÙ‡</h1>
    <button onclick="logout()">Ø®Ø±ÙˆØ¬</button>
  </div>

  <div class="container">
    <div class="stats">
      <div class="card">ğŸ‘¤ Ú©Ø§Ø±Ø¨Ø±Ø§Ù†: <span id="user-count">0</span></div>
      <div class="card">ğŸ§‘â€ğŸ’¼ Ø§Ø¯Ù…ÛŒÙ†: <strong>admin</strong></div>
    </div>

    <div class="search-add">
      <input type="text" id="search" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ú©Ø§Ø±Ø¨Ø±..." oninput="loadUsers()">
      <input type="text" id="username" placeholder="Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ">
      <input type="email" id="email" placeholder="Ø§ÛŒÙ…ÛŒÙ„">
      <button onclick="addUser()">Ø§ÙØ²ÙˆØ¯Ù† Ú©Ø§Ø±Ø¨Ø±</button>
    </div>

    <table>
      <thead>
        <tr>
          <th>#</th>
          <th>Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ</th>
          <th>Ø§ÛŒÙ…ÛŒÙ„</th>
          <th>Ù†Ù‚Ø´</th>
          <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
        </tr>
      </thead>
      <tbody id="user-table"></tbody>
    </table>


  <div class="toast" id="toast"></div>
<!-- Ø¨Ø¹Ø¯ Ø§Ø² Ø¬Ø¯ÙˆÙ„ Ú©Ø§Ø±Ø¨Ø±Ø§Ù† Ø¯Ø± admin.html -->
<div class="section-title" style="margin-top: 40px; font-size: 1.5rem; color: #512da8; border-bottom: 2px solid #512da8; padding-bottom: 10px;">
  Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§
</div>

<div class="search-add" style="margin-top: 20px;">
  <input type="text" id="story-search" placeholder="Ø¬Ø³ØªØ¬Ùˆ Ø¯Ø§Ø³ØªØ§Ù†..." oninput="loadStories()">
  <select id="story-type" onchange="loadStories()">
    <option value="all">Ù‡Ù…Ù‡ Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§</option>
    <option value="uploaded">Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡</option>
    <option value="shared">Ø§Ø´ØªØ±Ø§Ú© Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡</option>
  </select>
</div>

<table style="margin-top: 20px;">
  <thead>
    <tr>
      <th>#</th>
      <th>Ø¹Ù†ÙˆØ§Ù†</th>
      <th>Ù†ÙˆÛŒØ³Ù†Ø¯Ù‡</th>
      <th>ØªØ§Ø±ÛŒØ®</th>
      <th>Ù†ÙˆØ¹</th>
      <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
    </tr>
  </thead>
  <tbody id="story-table"></tbody>
</table>
  <script>

// ØªÙˆØ§Ø¨Ø¹ Ø¬Ø¯ÛŒØ¯ Ø¨Ø±Ø§ÛŒ Ù…Ø¯ÛŒØ±ÛŒØª Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§
function loadStories() {
  const searchTerm = document.getElementById("story-search").value.toLowerCase();
  const storyType = document.getElementById("story-type").value;
  
  // Ø¯Ø±ÛŒØ§ÙØª Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ÛŒ Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡ Ùˆ Ø§Ø´ØªØ±Ø§Ú© Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡ Ø§Ø² localStorage
  const uploadedStories = JSON.parse(localStorage.getItem('uploadedStories')) || [];
  const sharedStories = JSON.parse(localStorage.getItem('sharedStories')) || [];
  
  let allStories = [];
  
  // ØªØ±Ú©ÛŒØ¨ Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ Ø¨Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ù†ÙˆØ¹ Ø¢Ù†Ù‡Ø§
  uploadedStories.forEach(story => {
    allStories.push({...story, type: 'uploaded'});
  });
  
  sharedStories.forEach(story => {
    allStories.push({...story, type: 'shared'});
  });
  
  // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ù†ÙˆØ¹ Ø¯Ø§Ø³ØªØ§Ù†
  if (storyType !== 'all') {
    allStories = allStories.filter(story => story.type === storyType);
  }
  
  // ÙÛŒÙ„ØªØ± Ú©Ø±Ø¯Ù† Ø¨Ø± Ø§Ø³Ø§Ø³ Ø¬Ø³ØªØ¬Ùˆ
  if (searchTerm) {
    allStories = allStories.filter(story => 
      story.title.toLowerCase().includes(searchTerm) ||
      (story.author || story.initialAuthor).toLowerCase().includes(searchTerm)
    );
  }
  
  // Ù…Ø±ØªØ¨ Ø³Ø§Ø²ÛŒ Ø¨Ø± Ø§Ø³Ø§Ø³ ØªØ§Ø±ÛŒØ® (Ø¬Ø¯ÛŒØ¯ØªØ±ÛŒÙ† Ø§ÙˆÙ„)
  allStories.sort((a, b) => {
    const dateA = new Date(a.date || a.createdAt);
    const dateB = new Date(b.date || b.createdAt);
    return dateB - dateA;
  });
  
  // Ù†Ù…Ø§ÛŒØ´ Ø¯Ø± Ø¬Ø¯ÙˆÙ„
  const table = document.getElementById("story-table");
  table.innerHTML = '';
  
  allStories.forEach((story, index) => {
    const row = document.createElement('tr');
    
    row.innerHTML = `
      <td>${index + 1}</td>
      <td>${story.title}</td>
      <td>${story.author || story.initialAuthor}</td>
      <td>${story.date || story.createdAt}</td>
      <td>${story.type === 'uploaded' ? 'Ø¢Ù¾Ù„ÙˆØ¯ Ø´Ø¯Ù‡' : 'Ø§Ø´ØªØ±Ø§Ú© Ú¯Ø°Ø§Ø±ÛŒ Ø´Ø¯Ù‡'}</td>
      <td>
        <button class="delete" onclick="deleteStory('${story.id || story.title}', '${story.type}')">Ø­Ø°Ù</button>
        <button class="edit" onclick="viewStory('${story.id || story.title}', '${story.type}')">Ù…Ø´Ø§Ù‡Ø¯Ù‡</button>
      </td>
    `;
    
    table.appendChild(row);
  });
}

function deleteStory(id, type) {
  if (!confirm('Ø¢ÛŒØ§ Ø§Ø² Ø­Ø°Ù Ø§ÛŒÙ† Ø¯Ø§Ø³ØªØ§Ù† Ø§Ø·Ù…ÛŒÙ†Ø§Ù† Ø¯Ø§Ø±ÛŒØ¯ØŸ')) return;
  
  if (type === 'uploaded') {
    let uploadedStories = JSON.parse(localStorage.getItem('uploadedStories')) || [];
    uploadedStories = uploadedStories.filter(story => story.title !== id);
    localStorage.setItem('uploadedStories', JSON.stringify(uploadedStories));
  } else {
    let sharedStories = JSON.parse(localStorage.getItem('sharedStories')) || [];
    sharedStories = sharedStories.filter(story => story.id !== id);
    localStorage.setItem('sharedStories', JSON.stringify(sharedStories));
  }
  
  showToast('Ø¯Ø§Ø³ØªØ§Ù† Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø­Ø°Ù Ø´Ø¯');
  loadStories();
}

function viewStory(id, type) {
  let story;
  
  if (type === 'uploaded') {
    const uploadedStories = JSON.parse(localStorage.getItem('uploadedStories')) || [];
    story = uploadedStories.find(s => s.title === id);
  } else {
    const sharedStories = JSON.parse(localStorage.getItem('sharedStories')) || [];
    story = sharedStories.find(s => s.id === id);
  }
  
  if (!story) {
    return showToast('Ø¯Ø§Ø³ØªØ§Ù† ÛŒØ§ÙØª Ù†Ø´Ø¯');
  }
  
  const content = story.content.length > 500 ? 
    story.content.substring(0, 500) + '...' : 
    story.content;
  
  alert(`Ø¹Ù†ÙˆØ§Ù†: ${story.title}\n\nÙ†ÙˆÛŒØ³Ù†Ø¯Ù‡: ${story.author || story.initialAuthor}\n\nÙ…Ø­ØªÙˆØ§:\n${content}`);
}

// ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ ØªØ§Ø¨Ø¹ Ù‡Ù†Ú¯Ø§Ù… Ù„ÙˆØ¯ ØµÙØ­Ù‡
window.addEventListener('DOMContentLoaded', () => {
  if (localStorage.getItem("username") === "admin") {
    loadUsers();
    loadStories(); // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¯Ø§Ø³ØªØ§Ù†â€ŒÙ‡Ø§ Ù‡Ù…Ø²Ù…Ø§Ù† Ø¨Ø§ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ ØµÙØ­Ù‡
  }
});

function editUser(username) {
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let user = users.find(u => u.username === username);
  
  if (!user) return;

  let newUsername = prompt("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ø¬Ø¯ÛŒØ¯:", user.username);
  if (!newUsername) return;

  // Ø¨Ø±Ø±Ø³ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ù†Ø¨ÙˆØ¯Ù† Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ
  if (newUsername !== username && users.some(u => u.username === newUsername)) {
    return showToast("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª!");
  }

  let newEmail = prompt("Ø§ÛŒÙ…ÛŒÙ„ Ø¬Ø¯ÛŒØ¯:", user.email);
  if (!newEmail) return;

  // Ø§Ø¹Ù…Ø§Ù„ ØªØºÛŒÛŒØ±Ø§Øª
  user.username = newUsername;
  user.email = newEmail;

  localStorage.setItem("users", JSON.stringify(users));
  showToast("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ú©Ø§Ø±Ø¨Ø± Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯");
  loadUsers();
}

function addUser() {
  let username = document.getElementById("username").value.trim();
  let email = document.getElementById("email").value.trim();
  
  if (!username || !email) {
    return showToast("Ù„Ø·ÙØ§Ù‹ ØªÙ…Ø§Ù… ÙÛŒÙ„Ø¯Ù‡Ø§ Ø±Ø§ Ù¾Ø± Ú©Ù†ÛŒØ¯");
  }

  let users = JSON.parse(localStorage.getItem("users")) || [];
  
  if (users.some(u => u.username === username)) {
    return showToast("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ Ù‚Ø¨Ù„Ø§Ù‹ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø´Ø¯Ù‡ Ø§Ø³Øª");
  }

  // Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† Ø³Ø·Ø­ Ø¯Ø³ØªØ±Ø³ÛŒ Ø¨Ù‡ Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯
  let newUser = {
    username,
    email,
    role: "user", // Ù…Ù‚Ø¯Ø§Ø± Ù¾ÛŒØ´â€ŒÙØ±Ø¶
    isActive: true // ÙˆØ¶Ø¹ÛŒØª ÙØ¹Ø§Ù„ Ø¨ÙˆØ¯Ù†
  };

  users.push(newUser);
  localStorage.setItem("users", JSON.stringify(users));
  
  // Ù¾Ø§Ú© Ú©Ø±Ø¯Ù† ÙÛŒÙ„Ø¯Ù‡Ø§
  document.getElementById("username").value = "";
  document.getElementById("email").value = "";
  
  showToast("Ú©Ø§Ø±Ø¨Ø± Ø¬Ø¯ÛŒØ¯ Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯");
  loadUsers();
}

function changeUserRole(username) {
  let users = JSON.parse(localStorage.getItem("users")) || [];
  let user = users.find(u => u.username === username);
  
  if (!user) return;

  let newRole = prompt("Ù†Ù‚Ø´ Ø¬Ø¯ÛŒØ¯ (admin/user):", user.role);
  if (!newRole || !["admin", "user"].includes(newRole)) return;

  user.role = newRole;
  localStorage.setItem("users", JSON.stringify(users));
  showToast(`Ù†Ù‚Ø´ Ú©Ø§Ø±Ø¨Ø± Ø¨Ù‡ ${newRole} ØªØºÛŒÛŒØ± ÛŒØ§ÙØª`);
  loadUsers();
}

function loadUsers() {
  const users = JSON.parse(localStorage.getItem("users")) || [];
  const search = document.getElementById("search").value.toLowerCase();
  const table = document.getElementById("user-table");
  const count = document.getElementById("user-count");

  let filtered = users.filter(u => u.username !== "admin"); // Ø¹Ø¯Ù… Ù†Ù…Ø§ÛŒØ´ Ø§Ø¯Ù…ÛŒÙ† Ø§ØµÙ„ÛŒ
  if (search) {
    filtered = filtered.filter(u => 
      u.username.toLowerCase().includes(search) || 
      u.email.toLowerCase().includes(search)
    );
  }

  table.innerHTML = "";
  filtered.forEach((user, i) => {
    table.innerHTML += `
      <tr>
        <td>${i + 1}</td>
        <td>${user.username}</td>
        <td>${user.email}</td>
        <td>${user.role || 'user'}</td>
        <td>
          <button class="edit" onclick="editUser('${user.username}')">ÙˆÛŒØ±Ø§ÛŒØ´</button>
          <button class="role" onclick="changeUserRole('${user.username}')">ØªØºÛŒÛŒØ± Ù†Ù‚Ø´</button>
          <button class="delete" onclick="deleteUser('${user.username}')">Ø­Ø°Ù</button>
        </td>
      </tr>`;
  });
  count.textContent = filtered.length;
}




    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.style.display = "block";
      setTimeout(() => toast.style.display = "none", 3000);
    }

    function loadUsers() {
      const users = JSON.parse(localStorage.getItem("users")) || [];
      const search = document.getElementById("search").value.toLowerCase();
      const table = document.getElementById("user-table");
      const count = document.getElementById("user-count");

      let filtered = users.filter(u => u.username !== "admin");
      if (search) {
        filtered = filtered.filter(u => u.username.toLowerCase().includes(search));
      }

      table.innerHTML = "";
      filtered.forEach((user, i) => {
        table.innerHTML += `
          <tr>
            <td>${i + 1}</td>
            <td>${user.username}</td>
            <td>${user.email}</td>
            <td>
              <button class="edit" onclick="editUser('${user.username}')">ÙˆÛŒØ±Ø§ÛŒØ´</button>
              <button class="delete" onclick="deleteUser('${user.username}')">Ø­Ø°Ù</button>
            </td>
          </tr>`;
      });
      count.textContent = filtered.length;
    }

    function addUser() {
      const username = document.getElementById("username").value.trim();
      const email = document.getElementById("email").value.trim();
      if (!username || !email) return showToast("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ù†Ø§Ù‚Øµ Ø§Ø³Øª.");

      let users = JSON.parse(localStorage.getItem("users")) || [];
      if (users.find(u => u.username === username)) return showToast("Ù†Ø§Ù… Ú©Ø§Ø±Ø¨Ø±ÛŒ ØªÚ©Ø±Ø§Ø±ÛŒ Ø§Ø³Øª.");

      users.push({ username, email });
      localStorage.setItem("users", JSON.stringify(users));
      document.getElementById("username").value = "";
      document.getElementById("email").value = "";
      showToast("Ú©Ø§Ø±Ø¨Ø± Ø§Ø¶Ø§ÙÙ‡ Ø´Ø¯.");
      loadUsers();
    }

    function deleteUser(username) {
      if (!confirm("Ø­Ø°Ù Ø´ÙˆØ¯ØŸ")) return;
      let users = JSON.parse(localStorage.getItem("users")) || [];
      users = users.filter(u => u.username !== username);
      localStorage.setItem("users", JSON.stringify(users));
      showToast("Ú©Ø§Ø±Ø¨Ø± Ø­Ø°Ù Ø´Ø¯.");
      loadUsers();
    }

    function editUser(username) {
      const newEmail = prompt("Ø§ÛŒÙ…ÛŒÙ„ Ø¬Ø¯ÛŒØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:");
      if (!newEmail) return;
      let users = JSON.parse(localStorage.getItem("users")) || [];
      let user = users.find(u => u.username === username);
      if (user) user.email = newEmail;
      localStorage.setItem("users", JSON.stringify(users));
      showToast("Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ù‡â€ŒØ±ÙˆØ²Ø±Ø³Ø§Ù†ÛŒ Ø´Ø¯.");
      loadUsers();
    }

    function logout() {
      localStorage.removeItem("username");
      window.location.href = "index.php";
    }

    if (localStorage.getItem("username") !== "admin") {
      alert("Ø¯Ø³ØªØ±Ø³ÛŒ ØºÛŒØ±Ù…Ø¬Ø§Ø²!");
      window.location.href = "index.php";
    } else {
      loadUsers();
    }
  </script>
</body>
</html>